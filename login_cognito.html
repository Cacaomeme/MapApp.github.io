<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Cognito ログイン</title>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1001.0.min.js"></script>
    <script src="https://unpkg.com/amazon-cognito-identity-js@6.3.1/dist/amazon-cognito-identity.min.js"></script>
</head>
<body style="text-align:center; padding-top:50px;">
    <h2>ログイン (Cognito)</h2>
    
    <input type="text" id="username" placeholder="ユーザーID"><br><br>
    <input type="password" id="password" placeholder="パスワード"><br><br>
    
    <button onclick="login()">ログイン</button>
    <br><br>
    <a href="signup_cognito.html">アカウントを新規作成する</a>

    <script>
        console.log("画面読み込み完了");

        // ★★★ ここを書き換える ★★★
        const poolData = {
            UserPoolId: 'us-east-1_3vVCLeEE8',  // これはさっきと同じでOK
            ClientId: '699nvvn5huliol6o6msae5qs09' // ★ここを「SPA」で作った新しいIDにする！
        };
        // ----------------------------------------

        const userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);

        function login() {
            console.log("ログインボタンが押されました");

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const authDetails = new AmazonCognitoIdentity.AuthenticationDetails({
                Username: username,
                Password: password
            });

            const userData = {
                Username: username,
                Pool: userPool
            };

            const cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

            cognitoUser.authenticateUser(authDetails, {
                onSuccess: function(result) {
                    console.log("ログイン成功！");
                    
                    // トークンなどが result に入っています
                    // 今までのメイン画面(main.html)が動くように、localStorageに名前を入れる
                    localStorage.setItem("myUserID", username);
                    
                    alert("ログイン成功！地図画面へ移動します。");
                    window.location.href = "main.html"; 
                },
                onFailure: function(err) {
                    console.error("ログイン失敗:", err);
                    alert("ログイン失敗:\n" + err.message);
                }
            });
        }
    </script>
</body>
</html>